<!DOCTYPE html>
<html>

    <head>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBUakDsIssIu0GPXFQzYPWZ8Cu1np6gSYM"></script>
    <style type="text/css">
 
        html, body, #map-canvas {
          width: 100%;
          height: 100%;
          margin: 0;
          padding: 0;
        }
         
        .rats, .rats svg {
          position: absolute;
        }
         
        .rats svg {
          width: 60px;
          height: 20px;
          padding-right: 100px;
          font: 10px sans-serif;
        }
         
        .rats circle {
          fill: brown;
          stroke: black;
          stroke-width: 1.5px;
        }
         
            </style>

    </head>


    <body>
    <div id="map_canvas"> </div>
    <script>
    $(window).load(function(){
        mapGenerator();
    });
     var map = new google.maps.Map(d3.select("#map-canvas").node(), {
              zoom: 12,
              center: new google.maps.LatLng(40.7199792,-73.9725163),
              mapTypeId: google.maps.MapTypeId.ROADMAP
            });

        function mapGenerator(){
            d3.json("/assets/javascripts/rats.json", function(data) {
              var overlay = new google.maps.OverlayView();
             
              // Add the container when the overlay is added to the map.
              overlay.onAdd = function() {
                var layer = d3.select(this.getPanes().overlayLayer).append("div")
                    .attr("class", "rats");
             
                // Draw each marker as a separate SVG element.
                // We could use a single SVG, but what size would it have?
                overlay.draw = function() {
                  var projection = this.getProjection(),
                      padding = 10;
             
                  var marker = layer.selectAll("svg")
                      .data(d3.entries(data))
                      .each(transform) // update existing markers
                    .enter().append("svg:svg")
                      .each(transform)
                      .attr("class", "marker");
             
                  // Add a circle.
                  marker.append("svg:circle")
                      .attr("r", 4.5)
                      .attr("cx", padding)
                      .attr("cy", padding);
             
                  // Add a label.
                  marker.append("svg:text")
                      .attr("x", padding + 7)
                      .attr("y", padding)
                      .attr("dy", ".31em")
                      .text(function(d) { return d.key; });
             
                  function transform(d) {
                    d = new google.maps.LatLng(d[1], d[0]);
                    d = projection.fromLatLngToDivPixel(d);
                    return d3.select(this)
                        .style("left", (d.x - padding) + "px")
                        .style("top", (d.y - padding) + "px");
                  }
                };
              };
             
              // Bind our overlay to the mapâ€¦
              overlay.setMap(map);
            });
         }

     </script>

        


    </body>

</html>
